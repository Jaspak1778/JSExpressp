<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
   
    <title>Herkut</title>
    <link rel="stylesheet" href="style.css"/>
</head>
<body>
    <center>
        <div id="pin-div">
            <input id="pin" placeholder="pin code" type=""password" />
            <button onclick=""checkPin()">Login</button>
        </div>
            
        <h1 class="hidden">Herkut ohjelma</h1>

        <div class="hidden" id="sisältö"></div>
    </center>

    <script>
        async function checkPin() {
            var pin = document.getElementById("pin").value
            const response = await fetch("https://localhost:3000/api/getpin")
            const correctPin = await response.json()

            if (pin == correctPin) {
            var hiddenElements = document.getElementsByClassName("hidden")

            for (i=0; i <hiddenElements.length; i++){
            hiddenElements[i].style.visibility ="visible"
            
            document.getElementById("pin-div").style.visibility ="hidden"   
            }  
            }
            else{
                alert("Väärä pinkoodi")
            }
        }
        async function fetchData() {
        document.getElementById("sisältö").innerHTML = "<h4>Ladataan..</h4>"
        
        var x = `<table><thead><th>Herkun nimi</th><th>Tuotekoodi</th></thead><tbody>`
        try {
        const response = await fetch("http://localhost:3000/api/herkut")
        const herkkudata = await response.json()

        await herkkudata.map(h => {
            x += `<tr><td>${h.name}</td><td>${h.id}</td></tr>`
        })

        x += `</tbody></table>`
        document.getElementById("sisältö").innerHTML = x
        }
        catch (error) {
            console.error("Error fetching data:", error)
        }

    }
        fetchData()
    </script>
</body>
</html>